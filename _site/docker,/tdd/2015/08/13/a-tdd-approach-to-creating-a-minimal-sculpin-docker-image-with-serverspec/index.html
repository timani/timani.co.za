<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]-->
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
    Remove this if you use the .htaccess -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>A TDD approach to creating a minimal Sculpin Docker image with Serverspec - Part 1 of 4</title>
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

    <link rel="shortcut icon" href="https://timani.github.io/timani.co.za/images/favicon.png">

    <!-- CSS: implied media="all"
    <link rel="stylesheet" href="https://timani.github.io/timani.co.za/css/style.css">
    -->
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="https://timani.github.io/timani.co.za/img/placeholder.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="https://timani.github.io/timani.co.za/images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <!-- More ideas for your <head> here: h5bp.com/docs/#head-Tips -->

    <!-- Rainbox lightweight syntax highlighter CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/themes/twilight.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://timani.github.io/timani.co.za/css/material.min.css">
    <link rel="stylesheet" href="https://timani.github.io/timani.co.za/css/custom.css">
    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
    </style>
    <!-- All JavaScript at the bottom, except for Modernizr and Respond.
    Modernizr enables HTML5 elements & feature detects; Respond is a polyfill for min/max-width CSS3 Media Queries
    For optimal performance, use a custom Modernizr build: www.modernizr.com/download/ -->
    <script src="https://timani.github.io/timani.co.za/js/libs/modernizr-2.0.min.js"></script>
    <script src="https://timani.github.io/timani.co.za/js/libs/respond.min.js"></script>
  </head>

  <body>


      <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header has-drawer">
          <header class="demo-header mdl-layout__header mdl-layout__header--scroll  mdl-color--grey-100 mdl-color-text--grey-800">
  <div class="mdl-layout__header-row">
    <div class="mdl-layout__drawer-button"><i class="material-icons">menu</i></div>
    <div class="mdl-layout-spacer"></div>
    <nav class="demo-navigation mdl-navigation">
      <a class="mdl-navigation__link" target="_blank" href="https://twitter.com/timani_net/">Twitter</a>
      <a class="mdl-navigation__link" target="_blank" href="https://github.com/timani/">Github</a>
      <a class="mdl-navigation__link" target="_blank" href="https://timani.github.io/timani.co.za/rss.xml">RSS</a>
    </nav>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
      <label class="mdl-button mdl-js-button mdl-button--icon" for="search">
        <i class="material-icons">search</i>
      </label>
      <div class="mdl-textfield__expandable-holder">
        <input class="mdl-textfield__input" type="text" id="search">
        <label class="mdl-textfield__label" for="search">Enter your query...</label>
      </div>
    </div>
  </div>
</header>
<div class="demo-ribbon"></div>

<div class="demo-drawer mdl-layout__drawer">
  <div id="text-1" class="widget widget_text" style="
padding: 20px;
font-size: 85%;
"><div class="textwidget"><p style="
/* padding: 20px; */
/* margin-bottom: 0; */
">
      <img src="http://127.0.0.1:4000/img/placeholder.png" style="border-radius: 101px;" width="140">
      <h4 class="widget-title" style="
      font-size: 18px;
      margin-bottom: 5px;
      ">About</h4>
</p>We’re Helium, a web design agency. We love design and we try to make the web a better place.

<p><a  href="https://timani.github.io/timani.co.za/about/index.html">More about me &raquo;</a></p>
</div></div>

  <div class="android-drawer-separator" style="
border-bottom: 1px solid #ddd;
"></div>
<div id="text-1" class="widget widget_text" style="
padding: 20px;
font-size: 85%;
">  <h4 style="
font-size: 18px;
margin-bottom: 5px;
margin-top: 10px;
">
          Navigation
        </h4>
        <nav class="mdl-navigation">
            <a class="mdl-navigation__link first" href="https://timani.github.io/timani.co.za/blog/index.html">&raquo; Home</a>
            <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/blog/index.html">&raquo; Blog</a>
            <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/archives/index.html">&raquo; Archives</a>
            <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/about/index.html">&raquo; About</a>
            <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/contact/index.html">&raquo; Contact</a>

                    </nav>
  </div>

    <div class="android-drawer-separator" style="
  border-bottom: 1px solid #ddd;
  "></div>
          <div class="widget" style="
        padding: 20px;
        font-size: 85%;
        "><h4 class="widget-title"  style="
font-size: 18px;
margin-bottom: 5px;
margin-top: 10px;
        ">Latest Posts</h4>
    <article>
      <div>
        <a href="/2015/08/15/deplpoying-sculpin-to-google-compute-with-ansible/" class="post-title-archive">Deploying Sculping to Google Compute Engine using Ansible - Part 4 of 4</a>
      </div>
      <div class="mdl-color-text--grey-800">
        Posted: 15 Aug 2015
      </div>
    </article>
    <article>
      <div>
        <a href="/2015/08/13/creating-a-minimal-sculpin-docker-image/" class="post-title-archive">Using minimal Sculpin docker image to developing static sites - Part 2 of 4</a>
      </div>
      <div class="mdl-color-text--grey-800">
        Posted: 13 Aug 2015
      </div>
    </article>

    <article>
      <div>
        <a href="/2015/08/13/a-tdd-approach-to-creating-a-minimal-sculpin-docker-image-with-serverspec/" class="post-title-archive">A TDD approach to creating a minimal Sculpin Docker image with Serverspec - Part 1 of 4</a>
      </div>
      <div class="mdl-color-text--grey-800">
        Posted: 13 Aug 2015
      </div>

    </article>

    <article>
      <div>
        <a href="/2015/08/12/publishing-a-docker-image-and-automating-tests-with-circleci/" class="post-title-archive">Publishing a docker image and automating tests with travisci - Part 3 of 4</a>
      </div>
      <div class="mdl-color-text--grey-800">
        Posted: 12 Aug 2015
      </div>

    </article>
    <br/>
<p><a  href="https://timani.github.io/timani.co.za/blog/index.html">View all posts &raquo;</a></p>
</div>



      </div>

<a href="#" target="_blank" id="view-source"class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--accent mdl-color-text--accent-contrast" data-upgraded=",MaterialButton,MaterialRipple">View Source<span class="mdl-button__ripple-container">
  <span class="mdl-ripple is-animating" ></span></span></a>
      <main  class="demo-main mdl-layout__content">
        <div class="demo-container mdl-grid">
          <div class="demo-content mdl-color--white content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col mdl-cell--12-col-tablet mdl-cell--12-col-phone">
              <div class="mdl-layout__header-row" id="top-nav" style="clear: both;display: block;text-align: center;">
  <div style="overflow: hidden;display: block;clear: both;width: 100%;">
    <p>
      <a class="mdl-navigation__link mdl-typography--text-uppercase" href="https://timani.github.io/timani.co.za/">
        <img src="https://timani.github.io/timani.co.za/img/placeholder.png" style="border-radius: 101px;">
      </a>
    </p>
    <div class="main-nav-container">
      <nav class="main-nav mdl-navigation">
        <a class="mdl-navigation__link first" href="https://timani.github.io/timani.co.za/blog/index.html">Home</a>
        <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/blog/index.html">Blog</a>
        <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/archives/index.html">Archives</a>
        <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/about/index.html">About</a>
        <a class="mdl-navigation__link" href="https://timani.github.io/timani.co.za/contact/index.html">Contact</a>
      </nav>
    </div>
  </div>
</div>

              <div class="demo-crumbs mdl-color-text--grey-500">
                <a href="https://timani.github.io/timani.co.za" class="mdl-color-text--grey-500">Home</a> &raquo;
                <a href="https://timani.github.io/timani.co.za/blog/index.html" class="mdl-color-text--grey-500">Blog</a> &raquo; A TDD approach to creating a minimal Sculpin Docker image with Serverspec - Part 1 of 4
              </div>
              <article class="h-entry">
                <h3 class="entry-title">A TDD approach to creating a minimal Sculpin Docker image with Serverspec - Part 1 of 4</h3>
                <div class="e-content">
                  <div>
                    <div class="mdl-layout-">
                      <p class="meta-section tags mdl-color-text--grey-800">
                        Posted <a class="p-author h-card" style="border-bottom:dotted; border-color:#ccc; color:#aaa; display:none" href="#">W. Developer</a>  on
                        <time class="dt-published" datetime="2013-06-13 12:00:00"><span class="tutorial-date">Oct 14, 2013</span></time>
                         <span class="hashtag-icon"> Categories: </span>
                         <a class="" href="/community/tags/one-click-install-apps?type=tutorials">One-Click Install Apps</a>,
                         <a class="" href="/community/tags/ghost?type=tutorials">Ghost</a>,
                         <a class="" href="/community/tags/nginx?type=tutorials">Nginx</a>
                      </p>
                      </div>
                    <!-- <div>
                      <a href="#">
                        <i class="fa fa-share-alt"></i>
                      </a>
                      <a href="#">
                        <i class="fa fa-link"></i>
                      </a>
                      <a href="#">
                        <i class="fa fa-twitter"></i>
                      </a>
                      <a href="#">
                        <i class="fa fa-linkedin"></i>
                      </a>
                      <a href="#">
                        <i class="fa fa-envelope-o"></i>
                      </a>
                    </div> -->
                  </div>
                </div>
                  <p>We most frequently use Curl in the form of <code>libcurl</code>, a C library providing function transferring data between servers using many of the popular protocols like HTTP, FTP, SCP, and so on. This library is the foundation things like all the curl_*() functions in PHP, which are useful for writing code that interacts with various web services.</p>

<!--more-->

<h3 id="summary">Summary</h3>

<p>This is sample project for Test Driven Development (TDD) of Dockerfile by RSpec. This means developing dockerfile by below cycle.</p>

<h6 id="table-of-contents">Table of contents</h6>

<ul>
  <li><a href="#gh-md-toc">Overview</a>
    <ul>
      <li><a href="#local-files">TDD</a></li>
    </ul>
  </li>
  <li><a href="#table-of-contents">Getting started</a>
    <ul>
      <li><a href="#local-files">Defining Requirements</a></li>
    </ul>
  </li>
  <li><a href="#installation">Setting up Development environment</a>
    <ul>
      <li><a href="#local-files">Drivers</a></li>
      <li><a href="#local-files">Provisioners</a></li>
      <li><a href="#multiple-files">Platforms</a></li>
      <li><a href="#combo">Suites</a></li>
    </ul>
  </li>
  <li><a href="#usage">Tesk Kitchen</a>
    <ul>
      <li><a href="#remote-files">Write a test</a></li>
      <li><a href="#stdin">Writing a playbook</a></li>
      <li><a href="#local-files">Kitchen List</a></li>
      <li><a href="#local-files">Kitchen Converge</a></li>
      <li><a href="#multiple-files">Kichen Verify</a></li>
      <li><a href="#combo">Kitchen Test</a></li>
    </ul>
  </li>
  <li><a href="#tests">Build Docker image</a>
    <ul>
      <li><a href="#local-files">Kitchen List</a></li>
      <li><a href="#local-files">Kitchen Converge</a></li>
      <li><a href="#multiple-files">Kichen Verify</a></li>
      <li><a href="#combo">Kitchen Test</a></li>
    </ul>
  </li>
  <li><a href="#dependency">Conclusion</a></li>
</ul>

<h3 id="overview">Overview</h3>

<p>Allow your teams to use their favorite Agile lifecycle tools while maintaining full visibility and control.
Requirements</p>

<ul>
  <li>Test Driven Development for containers with serverspec</li>
</ul>

<h3 id="getting-started">Getting started</h3>

<ul>
  <li>what this section is about</li>
  <li>why it matters</li>
</ul>

<p>Defining requirements</p>

<ul>
  <li>research or examples</li>
</ul>

<p>Here you can search for any topic that interests you, find information, images, quotes, citations and more, and then quickly insert them into your document.</p>

<table class="mdl-data-table mdl-js-data-table" width="100%">
  <thead>
    <tr>
      <th class="mdl-data-table__cell--non-numeric">Component</th>
      <th class="mdl-data-table__cell--non-numeric">Description</th>
      <th class="mdl-data-table__cell--non-numeric">Type</th>
      <th class="mdl-data-table__cell--non-numeric">Condition</th>
      <th class="mdl-data-table__cell--non-numeric">Criteria</th>
      <th class="mdl-data-table__cell--non-numeric">Status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">fcgi</td>
      <td class="mdl-data-table__cell--non-numeric">package</td>
      <td class="mdl-data-table__cell--non-numeric">Should be</td>
      <td class="mdl-data-table__cell--non-numeric">Installed</td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">git</td>
      <td class="mdl-data-table__cell--non-numeric">package</td>
      <td class="mdl-data-table__cell--non-numeric">Should be</td>
      <td class="mdl-data-table__cell--non-numeric">Installed</td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">tar</td>
      <td class="mdl-data-table__cell--non-numeric">package</td>
      <td class="mdl-data-table__cell--non-numeric">Should be</td>
      <td class="mdl-data-table__cell--non-numeric">Installed</td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">zip</td>
      <td class="mdl-data-table__cell--non-numeric">package</td>
      <td class="mdl-data-table__cell--non-numeric">Should be</td>
      <td class="mdl-data-table__cell--non-numeric">Installed</td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">Tag</td>
      <td class="mdl-data-table__cell--non-numeric">file</td>
      <td class="mdl-data-table__cell--non-numeric">Should be</td>
      <td class="mdl-data-table__cell--non-numeric"><code>Alpine Linux</code></td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">composer</td>
      <td class="mdl-data-table__cell--non-numeric">command</td>
      <td class="mdl-data-table__cell--non-numeric">Should match</td>
      <td class="mdl-data-table__cell--non-numeric"><code>/usr/local/bin/composer</code></td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Base</td>
      <td class="mdl-data-table__cell--non-numeric">sculpin</td>
      <td class="mdl-data-table__cell--non-numeric">command</td>
      <td class="mdl-data-table__cell--non-numeric">Should match</td>
      <td class="mdl-data-table__cell--non-numeric"><code>/usr/local/bin/sculpin</code></td>
      <td class="mdl-data-table__cell--non-numeric">****</td>
    </tr>
  </tbody>
</table>

<p>Table 1: Docker PHP requirements
- takeaways</p>

<h5 id="build-the-development-environment">Build the Development environment</h5>

<ul>
  <li>what this section is about</li>
</ul>

<p>Once we have the requirements we can proceed to setup and configure test-kitchen.</p>

<ul>
  <li>
    <p>why it matters</p>
  </li>
  <li>
    <p>research or examples</p>
  </li>
</ul>

<h6 id="step-1-add-test-kitchen-to-a-gemfile-within-the-project">Step 1: Add Test Kitchen to a <code>Gemfile</code> within the project:</h6>

<pre><code data-language="ruby">source 'https://rubygems.org'
gem 'test-kitchen', '~&gt; 1.0'
gem 'docker'
gem 'serverspec'

group :integration do
  gem 'kitchen-docker', '~&gt; 0.11'
end
</code></pre>

<p>This will install <code>test-kitchen</code>, <code>kitchen-docker</code> and <code>kitchen-ansible</code> to provision and test the docker image to make sure it meets our requirements.</p>

<ul>
  <li><code>docker</code>: A “Test Kitchen driver” - it tells test-kitchen how to interact with an appliance (machine), such as Vagrant, EC2, Rackspace, etc.</li>
  <li><code>serverspec</code>: To validate the images we will use serverspec.</li>
  <li><code>kitchen-docker</code>: A “Test Kitchen driver” - it tells test-kitchen how to interact with an appliance (machine), such as Vagrant, EC2, Rackspace, etc.</li>
  <li><code>kitchen-ansible</code>: A provisioner for Test Kitchen to create and manage instances.</li>
</ul>

<h6 id="step-2-run-the-bundle-command-to-install">Step 2: Run the <code>bundle</code> command to install</h6>

<pre><code data-language="shell"># Install dependencies
$ bundle install
# Verify Test Kitchen is installed, run the kitchen help command:
$ bundle exec kitchen help
# You should see something like:
$ kitchen version   # Print Kitchen's version information
Test Kitchen version 1.4.2
</code></pre>

<ul>
  <li>takeaways</li>
</ul>

<h3 id="configure-test-kitchen">Configure Test Kitchen</h3>

<ul>
  <li>what this section is about</li>
</ul>

<p>The easiest way is to map out a table of the <code>kitchen.yml</code> or section that you will want to make sure is configured correctly. For example, in our case we will be looking at the Configuration of the container to make sure ruby is installed.</p>

<pre><code data-language="yaml"># kitchen.yml
---
driver:
  name: docker

platforms:
- name: ubuntu
  driver_config:
    image: ubuntu:14.04
    platform: ubuntu
  run_list:
  - recipe[apt]
</code></pre>

<h6 id="drivers">Drivers</h6>

<p>For example, in our case we will be looking at the Configuration. The easiest way is to map out a table of assignment.</p>

<pre><code data-language="yaml">driver:
  name: docker
</code></pre>

<h6 id="provisioners">Provisioners</h6>

<p>Tools used to converge an environment. During convergence the Configuration is run against a set of Platforms.</p>

<pre><code data-language="yaml">provisioner:
  name: ansible_playbook
</code></pre>

<h6 id="platforms">Platforms</h6>
<p>Using the same Serverspec and RSpec tests we already use for our Ansible scripts. Thanks for the heads up and keep up the great work ;-). Operating systems</p>

<pre><code data-language="yaml">platforms:
- name: ubuntu
  driver_config:
    image: ubuntu:14.04
    platform: ubuntu
</code></pre>

<h6 id="test-suites">Test Suites</h6>

<p>Using the same Serverspec and RSpec tests we already use for our Ansible scripts. Thanks for the heads up and keep up the great work ;-). Operating systems</p>

<pre><code data-language="yaml">suites:
- name: default
  run_list:
  ubuntu:
</code></pre>

<ul>
  <li>why it matters</li>
  <li>research or examples</li>
  <li>takeaways</li>
</ul>

<pre><code data-language="shell">$ kitchen list
Instance             Driver   Provisioner  Last Action
default-ubuntu-1204  Vagrant  ChefSolo     &lt; Not Created&gt;
</code></pre>

<p>So what’s this default-ubuntu-1204 thing and what’s an “Instance”? A Test Kitchen Instance is a pairwise combination of a Suite and a Platform as laid out in your .kitchen.yml file. Test Kitchen has auto-named your only instance by combining the Suite name (“default”) and the Platform name (“ubuntu-12.04”) into a form that is safe for DNS and hostname records, namely “default-ubuntu-1204”</p>

<h3 id="development-workflow">Development workflow</h3>

<p>The Platform name (“ubuntu-12.04”) into a form that is safe for DNS and hostname records, namely “default-ubuntu-1204”</p>

<h5 id="step-1create">Step 1:Create</h5>

<p>Okay, let’s spin this Instance up to see what happens. Test Kitchen calls this the Create Action. We’re going to be painfully explicit and ask Test Kitchen to only create the default-ubuntu-1204 instance:</p>

<pre><code data-language="shell">#Create the default-ubuntu-1204 instance
$ kitchen create default-ubuntu-1204

$ kitchen list
Instance             Driver   Provisioner  Last Action
default-ubuntu-1204  Vagrant  ChefSolo     Created
</code></pre>

<p>Test Kitchen has a login subcommand for just these kinds of situations:</p>

<pre><code data-language="shell">
$ kitchen login default-ubuntu-1204
Welcome to Ubuntu 12.04.2 LTS (GNU/Linux 3.5.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com/
Last login: Sat Nov 30 21:56:59 2013 from 10.0.2.2
vagrant@default-ubuntu-1204:~$
</code></pre>

<h5 id="step-2converge">Step 2:Converge</h5>

<p>Now that we have some code, let’s let Test Kitchen run it for us on our Ubuntu 12.04 instance:</p>

<pre><code data-language="shell">
$ kitchen converge default-ubuntu-1204
-----&gt; Starting Kitchen (v1.0.0)
-----&gt; Converging &lt; default-ubuntu-1204 &gt;...
       Preparing files for transfer
       Preparing current project directory as a cookbook
       Removing non-cookbook files before transfer
-----&gt; Installing Chef Omnibus (true)
       downloading https://www.opscode.com/chef/install.sh
         to file /tmp/install.sh
       trying wget...
Downloading Chef  for ubuntu...
Installing Chef
Selecting previously unselected package chef.
(Reading database ... 53291 files and directories currently installed.)
Unpacking chef (from .../tmp.GUasmrcD/chef__amd64.deb) ...
Setting up chef (11.8.0-1.ubuntu.12.04) ...
Thank you for installing Chef!
       Transfering files to &lt; default-ubuntu-1204 &gt;
[2013-11-30T21:55:45+00:00] INFO: Forking chef instance to converge...
Starting Chef Client, version 11.8.0
[2013-11-30T21:55:45+00:00] INFO: *** Chef 11.8.0 ***
[2013-11-30T21:55:45+00:00] INFO: Chef-client pid: 1162
[2013-11-30T21:55:46+00:00] INFO: Setting the run_list to ["recipe[git::default]"] from JSON
[2013-11-30T21:55:46+00:00] INFO: Run List is [recipe[git::default]]
[2013-11-30T21:55:46+00:00] INFO: Run List expands to [git::default]
[2013-11-30T21:55:46+00:00] INFO: Starting Chef Run for default-ubuntu-1204
[2013-11-30T21:55:46+00:00] INFO: Running start handlers
[2013-11-30T21:55:46+00:00] INFO: Start handlers complete.
Compiling Cookbooks...
Converging 2 resources
Recipe: git::default
  * package[git] action install[2013-11-30T21:55:46+00:00] INFO: Processing package[git] action install (git::default line 1)

    - install version 1:1.7.9.5-1 of package git

  * log[Well, that was too easy] action write[2013-11-30T21:56:14+00:00] INFO: Processing log[Well, that was too easy] action write (git::default line 3)
[2013-11-30T21:56:14+00:00] INFO: Well, that was too easy


[2013-11-30T21:56:14+00:00] INFO: Chef Run complete in 28.139177847 seconds
[2013-11-30T21:56:14+00:00] INFO: Running report handlers
[2013-11-30T21:56:14+00:00] INFO: Report handlers complete
Chef Client finished, 2 resources updated
       Finished converging &lt; default-ubuntu-1204 &gt; (1m3.91s).
-----&gt; Kitchen is finished. (1m4.22s)
</code></pre>

<p>Converge will always exit with code 0 if my operation was successful.</p>

<p>Let’s check the status of our instance:</p>
<pre><code data-language="shell">
$ kitchen list
Instance             Driver   Provisioner  Last Action
default-ubuntu-1204  Vagrant  ChefSolo     Converged
</code></pre>

<h5 id="step-3verify">Step 3:Verify</h5>

<p>Excellent, 3 success messages just as we had hoped. The reason is because our docker image has met all of the dependencies based on the requirements</p>

<h3 id="initialize-serverspec">Initialize Serverspec</h3>

<p>and create the first outline of our tests.</p>

<h5 id="step-1create-serverspec-within-the-project">Step 1:Create Serverspec within the project</h5>

<pre><code data-language="shell">$ serverspec-init
Select OS type:

  1) UN*X
  2) Windows

Select number: 1

Select a backend type:

  1) SSH
  2) Exec (local)

Select number: 1

Vagrant instance y/n: n
Input target host name: www.example.jp
 + spec/
 + spec/www.example.jp/
 + spec/www.example.jp/sample_spec.rb
 + spec/spec_helper.rb
 + Rakefile
 + .rspec
</code></pre>

<ul>
  <li>takeaways</li>
</ul>

<h5 id="step-2-create-serverpec-tests">Step 2: Create Serverpec tests</h5>

<p>Based on the requirements we defined in the dependencies we can create the matching test suite</p>

<pre><code data-language="ruby"># spec/Dockerfile_spec.rb

require "serverspec"
require "docker"

describe "Dockerfile" do
  before(:all) do
    image = Docker::Image.build_from_dir('.')

    set :os, family: :debian
    set :backend, :docker
    set :docker_image, image.id
  end

  it "installs the right version of Ubuntu" do
    expect(os_version).to include("Ubuntu 14")
  end

  def os_version
    command("lsb_release -a").stdout
  end
end
</code></pre>

<p>Updated project directory with the new infrastructure tests</p>

<pre><code data-language="shell">├── .gitignore
├── .rspec
├── Gemfile
├── Rakefile
└── specs/
</code></pre>

<h3 id="run-initial-tests---red">Run initial tests -&gt; <code>RED</code></h3>

<ul>
  <li>what this section is about</li>
  <li>why it matters</li>
  <li>research or examples</li>
</ul>

<p>Running the first serverspec tests</p>
<pre><code data-language="shell">$ rspec spec/Dockerfile_spec.rb
1 example, 3 failures
</code></pre>

<p>Excellent, 3 failures messages just as we had hoped. The reason is because our docker image has not been created yet and does not meet the requirements.</p>

<ul>
  <li>takeaways</li>
</ul>

<h5 id="building-the-docker-image">Building the docker image</h5>

<ul>
  <li>what this section is about</li>
  <li>why it matters</li>
  <li>research or examples</li>
</ul>

<p>Create a Dockerfile and add it to the repository with the following contents. This will install ruby as well as bundler so we can add the gems for bootstrap and start working on the theme:</p>

<pre><code data-language="shell">FROM centos:7
MAINTAINER timani tunduwani

# Install Remi Collet's repo for CentOS 7
RUN yum -y install \
  http://rpms.famillecollet.com/enterprise/remi-release-7.rpm

# Install PHP and Percona (MySQL) client stuff and the latest stable PHP.
RUN yum -y install --enablerepo=remi,remi-php56 \
  httpd php php-gd php-xml php-zip pwgen psmisc tar git zip

RUN yum -y update &amp;&amp; yum clean all

# Add Composer
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
# Install Sculpin
RUN curl -O https://download.sculpin.io/sculpin.phar; chmod +x sculpin.phar; mv sculpin.phar /usr/local/bin/sculpin
# Expose the port for the sculpin server
EXPOSE 8000
# Move to the directory were the sculpin PHP files will be located
WORKDIR /var/www
COPY ./run.sh /var/www/
CMD bash /var/www/run.sh
</code></pre>

<p>Updated project directory with the new Docker tests</p>

<pre><code data-language="shell">
├── .gitignore
├── .rspec
├── Dockerfile
├── Gemfile
├── Rakefile
└── specs/
</code></pre>

<ul>
  <li>takeaways</li>
</ul>

<h5 id="build-docker-image-and-run-test---green">Build Docker image and run test -&gt; <code>GREEN</code></h5>

<ul>
  <li>what this section is about</li>
  <li>why it matters</li>
  <li>research or examples</li>
</ul>

<p>Running the first serverspec tests</p>
<pre><code data-language="shell">
$ rspec spec/Dockerfile_spec.rb
1 example, 3 failures
</code></pre>

<p>Excellent, 3 success messages just as we had hoped. The reason is because our docker image has met all of the dependencies based on the requirements</p>

<ul>
  <li>takeaways</li>
</ul>

<h5 id="adding-vagrant-support">Adding Vagrant Support</h5>

<ul>
  <li>what this section is about</li>
  <li>why it matters</li>
  <li>research or examples</li>
  <li>takeaways</li>
</ul>

<p>https://robots.thoughtbot.com/tdd-your-dockerfiles-with-rspec-and-serverspec</p>


                  <div class="mdl-grid" style="
    border-top: 1px solid #efefef;
    border-bottom: 1px solid #efefef;
">
  <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--12-col-phone" style="
    /* border-right: 1px solid #dedede; */
"><div class="" style="">
  <h6>&laquo; Prev</h6>
                  <a class="url fn" href="https://timani.co.za">Publishing a docker image and automating tests with travisci - Part 3 of 4</a>
                  <div class="adr"> <span class="country-name">Posted on Oct 14th, 2015</span></div>
                  Dolore ex deserunt aute fugiat aute nulla ea sunt aliqua nisi cupidatat eu. Duis nulla tempor do aute et eiusmod velit exercitation nostrud quis <a href="#">proident minim</a></div></div>
  <div class="mdl-cell mdl-cell--6-col mdl-cell--4-col-tablet mdl-cell--12-col-phone" style="


"><div class="" style="">
  <h6>Next &raquo;</h6>
                  <a class="url fn" href="https://timani.co.za">Using minimal Sculpin docker image to developing static sites - Part 2 of 4</a>
                  <div class="adr"> <span class="country-name">Posted on Nov 29th, 2015</span></div>
                  Dolore ex deserunt aute fugiat aute nulla ea sunt aliqua nisi cupidatat eu. Duis nulla tempor do aute et eiusmod velit exercitation nostrud quis <a href="#">proident minim</a></div></div>
</div>
              </article>
              <div class="mdl-grid mdl-grid--no-spacing vcard mdl-shadow--2dp" id="hcard-Timani-Tunduwani">
                <div class="section__circle-container mdl-cell mdl-cell--2-col mdl-cell--1-col-phone">
                  <div class="section__circle-container__circle"><img src="http://www.gravatar.com/avatar/bac5f46541d2e394355c0f46a03d81ff.jpg?s=200" alt="photo of " class="photo" width="85%" style="
    padding: 20px;"></div>
                </div>
                <div class="section__text mdl-cell mdl-cell--9-col-desktop mdl-cell--6-col-tablet mdl-cell--3-col-phone" style="
    padding: 35px;
">
                  <a class="url fn" href="https://timani.co.za">Timani Tunduwani</a>
                  <div class="adr"> <span class="country-name">United States</span></div>
                  Dolore ex deserunt aute fugiat aute nulla ea sunt aliqua nisi cupidatat eu.
                  Duis nulla tempor do aute et eiusmod velit exercitation nostrud quis
                  </div>

              <div class="mdl-card__actions mdl-card--border">
                  <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
                    Read more &raquo;
                  </a>
              </div>    </div>


              <div id="disqus_thread"></div>
                  <script type="text/javascript">
                      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                      var disqus_shortname = 'timani'  ; // required: replace example with your forum shortname
                      // var disqus_developer = 1; // Comment out when the site is live
                      var disqus_identifier = "/docker,/tdd/2015/08/13/a-tdd-approach-to-creating-a-minimal-sculpin-docker-image-with-serverspec/";

                      /* * * DON'T EDIT BELOW THIS LINE * * */
                      (function() {
                          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                      })();
                  </script>
                  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
            </div>
      </main>

    <footer class="demo-footer mdl-mini-footer">
  <div class="mdl-mini-footer--left-section">
    <ul class="mdl-mini-footer--link-list">
      <li><a href="#">Help</a></li>
      <li><a href="#">Privacy and Terms</a></li>
      <li><a href="#">User Agreement</a></li>
    </ul>
  </div>
</footer>



    <div id="container">  </div> <!--! end of #container -->
<!-- JavaScript at the bottom for fast page loading -->

<!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/1.3.0/anchor.min.js"></script>

<!-- scripts concatenated and minified via ant build script-->
<script src="https://timani.github.io/timani.co.za/js/plugins.js"></script>
<script src="https://timani.github.io/timani.co.za/js/script.js"></script>

<!-- Material Design JS-->
<script src="https://storage.googleapis.com/code.getmdl.io/1.0.6/material.min.js"></script>

<!-- you can create a custom build with specific languages
this should go before the closing </body> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/rainbow.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/generic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/csharp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/php.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/ruby.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rainbow/1.2.0/js/language/shell.min.js"></script>


<!-- end scripts-->

<!-- mathiasbynens.be/notes/async-analytics-snippet Change UA-XXXXX-X to be your site's ID
<script>
  var _gaq=[['_setAccount','UA-XXXXX-X'],['_trackPageview'],['_trackPageLoadTime']];
  (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
  g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
  s.parentNode.insertBefore(g,s)}(document,'script'));
</script> -->

<!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.
     chromium.org/developers/how-tos/chrome-frame-getting-started -->
<!--[if lt IE 7 ]>
  <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
  <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
<![endif]-->
</body>
</html>
